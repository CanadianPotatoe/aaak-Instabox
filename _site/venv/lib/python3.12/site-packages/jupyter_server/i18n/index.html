
<!DOCTYPE html>
<html lang='en'>

<!-- Look in _includes/theme for <head> and <body> definitions -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Implementation Notes for Internationalization of Jupyter Notebook | DNHS Flocker</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Implementation Notes for Internationalization of Jupyter Notebook" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Social Media for Del Norte High School" />
<meta property="og:description" content="Social Media for Del Norte High School" />
<link rel="canonical" href="http://localhost:4100/flocker_frontend/venv/lib/python3.12/site-packages/jupyter_server/i18n/" />
<meta property="og:url" content="http://localhost:4100/flocker_frontend/venv/lib/python3.12/site-packages/jupyter_server/i18n/" />
<meta property="og:site_name" content="DNHS Flocker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Implementation Notes for Internationalization of Jupyter Notebook" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Social Media for Del Norte High School","headline":"Implementation Notes for Internationalization of Jupyter Notebook","url":"http://localhost:4100/flocker_frontend/venv/lib/python3.12/site-packages/jupyter_server/i18n/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/flocker_frontend/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4100/flocker_frontend/feed.xml" title="DNHS Flocker" />

<!-- Include favicons --><link rel="shortcut icon" type="image/x-icon" href="/flocker_frontend/images/favicon.ico"><!-- Include Primer CSS for styling -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />

<!-- Include Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<!-- Include Hypothesis annotations script if annotations are enabled --><!-- Include KaTeX and MathJax for rendering mathematical expressions if use_math is enabled -->


<script>
/**
 * Function to wrap images with a figure and caption if they have a title attribute.
 * This function is executed when the window loads.
 */
function wrap_img(fn) {
    // Check if the document is already loaded
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        // Select all images within elements with the class 'post'
        var elements = document.querySelectorAll(".post img");
        // Iterate over each image element
        Array.prototype.forEach.call(elements, function(el, i) {
            // Check if the image has a title attribute and is not an emoji
            if (el.getAttribute("title") && (el.className != "emoji")) {
                // Create a figcaption element for the caption
                const caption = document.createElement('figcaption');
                // Create a text node with the title attribute value
                var node = document.createTextNode(el.getAttribute("title"));
                // Append the text node to the figcaption element
                caption.appendChild(node);
                // Create a figure element to wrap the image and caption
                const wrapper = document.createElement('figure');
                // Add the 'image' class to the figure element
                wrapper.className = 'image';
                // Insert the figure element before the image
                el.parentNode.insertBefore(wrapper, el);
                // Remove the image from its original position
                el.parentNode.removeChild(el);
                // Append the image and caption to the figure element
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else {
        // If the document is not loaded, add an event listener to execute the function when it is
        document.addEventListener('DOMContentLoaded', fn);
    }
}
// Execute the wrap_img function when the window loads
window.onload = wrap_img;
</script>

<script>
/**
 * Function to add a link icon to anchor tags with the class 'anchor-link'.
 * This function is executed when the DOM content is loaded.
 */
document.addEventListener("DOMContentLoaded", function(){
    // Select all elements with the class 'anchor-link'
    var elem = document.querySelectorAll(".anchor-link");
    // Iterate over each element and set its inner HTML to a Font Awesome link icon
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
});
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/flocker_frontend/">DNHS Flocker</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/flocker_frontend/academics/">Academics</a><a class="page-link" href="/flocker_frontend/sports/">Sports</a><a class="page-link" href="/flocker_frontend/events/">Events</a><a class="page-link" href="/flocker_frontend/hangouts/">Instabox</a><a class="page-link" href="/flocker_frontend/sports/">Sports</a><a class="page-link" href="/flocker_frontend/login">Login</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
    <div class="wrapper">
      <article class="post">

  <h2 class="post-title">Implementation Notes for Internationalization of Jupyter Notebook</h2>
 
  <div class="post-content">
    <h1 id="implementation-notes-for-internationalization-of-jupyter-notebook">Implementation Notes for Internationalization of Jupyter Notebook</h1>

<p>The implementation of i18n features for jupyter notebook is still a work-in-progress:</p>

<ul>
  <li>User interface strings are (mostly) handled</li>
  <li>Console messages are not handled (their usefulness in a translated environment is questionable)</li>
  <li>Tooling has to be refined</li>
</ul>

<p>However…</p>

<h2 id="how-the-language-is-selected-">How the language is selected ?</h2>

<ol>
  <li><code class="language-plaintext highlighter-rouge">jupyter notebook</code> command reads the <code class="language-plaintext highlighter-rouge">LANG</code> environment variable at startup,
(<code class="language-plaintext highlighter-rouge">xx_XX</code> or just <code class="language-plaintext highlighter-rouge">xx</code> form, where <code class="language-plaintext highlighter-rouge">xx</code> is the language code you’re wanting to
run in).</li>
</ol>

<p>Hint: if running Windows, you can set it in PowerShell with <code class="language-plaintext highlighter-rouge">${Env:LANG} = "xx_XX"</code>.
if running Ubuntu 14, you should set environment variable <code class="language-plaintext highlighter-rouge">LANGUAGE="xx_XX"</code>.</p>

<ol>
  <li>The preferred language for web pages in your browser settings (<code class="language-plaintext highlighter-rouge">xx</code>) is
also used. At the moment, it has to be first in the list.</li>
</ol>

<h2 id="contributing-and-managing-translations">Contributing and managing translations</h2>

<h3 id="requirements">Requirements</h3>

<ul>
  <li><em>pybabel</em> (could be installed <code class="language-plaintext highlighter-rouge">pip install babel</code>)</li>
  <li><em>po2json</em> (could be installed with <code class="language-plaintext highlighter-rouge">npm install -g po2json</code>)</li>
</ul>

<p><strong>All i18n-related commands are done from the related directory :</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd notebook/i18n/
</code></pre></div></div>

<h3 id="message-extraction">Message extraction</h3>

<p>The translatable material for notebook is split into 3 <code class="language-plaintext highlighter-rouge">.pot</code> files, as follows:</p>

<ul>
  <li><em>notebook/i18n/notebook.pot</em> - Console and startup messages, basically anything that is
produced by Python code.</li>
  <li><em>notebook/i18n/nbui.pot</em> - User interface strings, as extracted from the Jinja2 templates
in <em>notebook/templates/*.html</em></li>
  <li><em>noteook/i18n/nbjs.pot</em> - JavaScript strings and dialogs, which contain much of the visible
user interface for Jupyter notebook.</li>
</ul>

<p>To extract the messages from the source code whenever new material is added, use the
<code class="language-plaintext highlighter-rouge">pybabel</code> command:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pybabel extract <span class="nt">-F</span> babel_notebook.cfg <span class="nt">-o</span> notebook.pot <span class="nt">--no-wrap</span> <span class="nt">--project</span> Jupyter <span class="nb">.</span>
pybabel extract <span class="nt">-F</span> babel_nbui.cfg <span class="nt">-o</span> nbui.pot <span class="nt">--no-wrap</span> <span class="nt">--project</span> Jupyter <span class="nb">.</span>
pybabel extract <span class="nt">-F</span> babel_nbjs.cfg <span class="nt">-o</span> nbjs.pot <span class="nt">--no-wrap</span> <span class="nt">--project</span> Jupyter <span class="nb">.</span>
</code></pre></div></div>

<p>After this is complete you have 3 <code class="language-plaintext highlighter-rouge">.pot</code> files that you can give to a translator for your favorite language.</p>

<h3 id="messages-compilation">Messages compilation</h3>

<p>After the source material has been translated, you should have 3 <code class="language-plaintext highlighter-rouge">.po</code> files with the same base names
as the <code class="language-plaintext highlighter-rouge">.pot</code> files above. Put them in <code class="language-plaintext highlighter-rouge">notebook/i18n/${LANG}/LC_MESSAGES</code>, where <code class="language-plaintext highlighter-rouge">${LANG}</code> is the language
code for your desired language ( i.e. German = “de”, Japanese = “ja”, etc. ).</p>

<p><em>notebook.po</em> and <em>nbui.po</em> need to be converted from <code class="language-plaintext highlighter-rouge">.po</code> to <code class="language-plaintext highlighter-rouge">.mo</code> format for
use at runtime.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pybabel compile <span class="nt">-D</span> notebook <span class="nt">-f</span> <span class="nt">-l</span> <span class="k">${</span><span class="nv">LANG</span><span class="k">}</span> <span class="nt">-i</span> <span class="k">${</span><span class="nv">LANG</span><span class="k">}</span>/LC_MESSAGES/notebook.po <span class="nt">-o</span> <span class="k">${</span><span class="nv">LANG</span><span class="k">}</span>/LC_MESSAGES/notebook.mo
pybabel compile <span class="nt">-D</span> nbui <span class="nt">-f</span> <span class="nt">-l</span> <span class="k">${</span><span class="nv">LANG</span><span class="k">}</span> <span class="nt">-i</span> <span class="k">${</span><span class="nv">LANG</span><span class="k">}</span>/LC_MESSAGES/nbui.po <span class="nt">-o</span> <span class="k">${</span><span class="nv">LANG</span><span class="k">}</span>/LC_MESSAGES/nbui.mo
</code></pre></div></div>

<p><em>nbjs.po</em> needs to be converted to JSON for use within the JavaScript code, with <em>po2json</em>, as follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>po2json -p -F -f jed1.x -d nbjs ${LANG}/LC_MESSAGES/nbjs.po ${LANG}/LC_MESSAGES/nbjs.json
</code></pre></div></div>

<p>When new languages get added, their language codes should be added to <em>notebook/i18n/nbjs.json</em>
under the <code class="language-plaintext highlighter-rouge">supported_languages</code> element.</p>

<h3 id="tips-for-jupyter-developers">Tips for Jupyter developers</h3>

<p>The biggest “mistake” I found while doing i18n enablement was the habit of constructing UI messages
from English “piece parts”. For example, code like:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Enter a new </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">name:</span><span class="dl">"</span><span class="p">;</span>
</code></pre></div></div>

<p>where <code class="language-plaintext highlighter-rouge">type</code> is either “file”, “directory”, or “notebook”….</p>

<p>is problematic when doing translations, because the surrounding text may need to vary
depending on the inserted word. In this case, you need to switch it and use complete phrases,
as follows:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">rename_msg</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="dl">"</span><span class="s2">file</span><span class="dl">"</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">(</span><span class="dl">"</span><span class="s2">Enter a new file name:</span><span class="dl">"</span><span class="p">);</span>
    <span class="k">case</span> <span class="dl">"</span><span class="s2">directory</span><span class="dl">"</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">(</span><span class="dl">"</span><span class="s2">Enter a new directory name:</span><span class="dl">"</span><span class="p">);</span>
    <span class="k">case</span> <span class="dl">"</span><span class="s2">notebook</span><span class="dl">"</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">(</span><span class="dl">"</span><span class="s2">Enter a new notebook name:</span><span class="dl">"</span><span class="p">);</span>
    <span class="nl">default</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">(</span><span class="dl">"</span><span class="s2">Enter a new name:</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Also you need to remember that adding an “s” or “es” to an English word to
create the plural form doesn’t translate well. Some languages have as many as 5 or 6 different
plural forms for differing numbers, so using an API such as ngettext() is necessary in order
to handle these cases properly.</p>

<h3 id="known-issues-and-future-evolutions">Known issues and future evolutions</h3>

<ol>
  <li>
    <p>Right now there are two different places where the desired language is set. At startup time, the Jupyter console’s messages pay attention to the setting of the <code class="language-plaintext highlighter-rouge">${LANG}</code> environment variable
as set in the shell at startup time. Unfortunately, this is also the time where the Jinja2
environment is set up, which means that the template stuff will always come from this setting.
We really want to be paying attention to the browser’s settings for the stuff that happens in the
browser, so we need to be able to retrieve this information after the browser is started and somehow
communicate this back to Jinja2. So far, I haven’t yet figured out how to do this, which means that if the ${LANG} at startup doesn’t match the browser’s settings, you could potentially get a mix
of languages in the UI ( never a good thing ).</p>
  </li>
  <li>
    <p>We will need to decide if console messages should be translatable, and enable them if desired.</p>
  </li>
  <li>
    <p>The keyboard shortcut editor was implemented after the i18n work was completed, so that portion
does not have translation support at this time.</p>
  </li>
  <li>
    <p>Babel’s documentation has instructions on how to integrate messages extraction
into your <em>setup.py</em> so that eventually we can just do:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./setup.py extract_messages
</code></pre></div>    </div>
  </li>
</ol>

<p>I hope to get this working at some point in the near future. 5. The conversions from <code class="language-plaintext highlighter-rouge">.po</code> to <code class="language-plaintext highlighter-rouge">.mo</code> probably can and should be done using <code class="language-plaintext highlighter-rouge">setup.py install</code>.</p>

<p>Any questions or comments please let me know @JCEmmons on github (emmo@us.ibm.com)</p>

  </div>

</article>

    </div>
  </main><footer class="site-footer h-card">
    <data class="u-url" href="/flocker_frontend/"></data>
  
    <div class="wrapper">
  
      <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://github.com/nighthawkcoders" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/flocker_frontend/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://x.com/NighthawkCoding/" target="_blank" title="x">
    <svg class="svg-icon grey">
      <use xlink:href="/flocker_frontend/assets/minima-social-icons.svg#x"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://www.youtube.com/@nighthawkcodingsociety2868" target="_blank" title="youtube">
    <svg class="svg-icon grey">
      <use xlink:href="/flocker_frontend/assets/minima-social-icons.svg#youtube"></use>
    </svg>
  </a>
</li>
</ul>
</div>
  
    </div>
  
</footer></body>
</html>
